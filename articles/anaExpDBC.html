<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Análise de Experimentos em Delineamento de Blocos Casualizados • labestData</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">labestData</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/index.html">Vinhetas</a>
</li>
<li>
  <a href="../reference/index.html">Datasets</a>
</li>
<li>
  <a href="../reference/index.html">Funções</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Análise de Experimentos em Delineamento de Blocos Casualizados</h1>
                        <h4 class="author">PET Estatística UFPR</h4>
            
          </div>

    
    
<div class="contents">
<div id="analise-exploratoria" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#analise-exploratoria" class="anchor"> </a></body></html>Análise exploratória</h2>
<p>Para exemplificação da análise de um experimento em delineamento de blocos casualizados (DBC), vamos considerar o conjunto de dados <code>PimentelEg5.2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(labestData)
## ls("package:labestData")</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">help</span>(PimentelEg5<span class="fl">.2</span>, <span class="dt">help_type =</span> <span class="st">"html"</span>)</code></pre></div>
<p>Nesse experimento estudou-se a produção (resposta) de variedades de batatinha (fator de interesse). O experimento foi instalado em blocos, muito provavelmente para controlar variáveis do ambiente, como a fertilidade do solo, por exemplo. Além disso, uma vez feita a imposição dos blocos, todas as demais variáveis de entrada (mão de obra, dia de colheita, máquinas, etc) devem ser as mesmas para todas as parcelas de um bloco. Isso significa, por exemplo, que todas as parcelas de um bloco devem ser colhidas no mesmo dia e devem ser zeladas (capina, irrigação) pela mesma pessoa. Lembre-se que a blocagem visa a uniformidade, ou seja, condições de contorno iguais para todas as suas parcelas, e por isso as variáveis de entrada precisam ser controladas também.</p>
<p>No conjunto de dados <code>PimentelEg5.2</code>, temos a variável <code>bloco</code> e <code>variedade</code>, ambas como fator. Esse é um detalhe importante: quando as fontes de variação forem de níveis categóricos, elas devem ser variáveis de classe <code>factor</code> no R. É preciso cuidado pois alguns livros usam números inteiros para representar os níveis de fatores categóricos, de tal forma que, se não as declararmos como fatores, o R as entenderá como variáveis numéricas.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#-----------------------------------------------------------------------</span>
<span class="co"># Ler a partir do repositório do labestData.</span>

<span class="co"># url &lt;- paste0("https://gitlab.c3sl.ufpr.br/pet-estatistica",</span>
<span class="co">#               "/labestData/raw/devel/data-raw/PimentelEg5.2.txt")</span>
<span class="co">#</span>
<span class="co"># PimentelEg5.2 &lt;-</span>
<span class="co">#     read.table(file = url, sep = "\t", header = TRUE)</span>

<span class="co">#-----------------------------------------------------------------------</span>
<span class="co"># Análise exploratória.</span>

<span class="co"># Estrutura do objeto.</span>
<span class="kw">str</span>(PimentelEg5<span class="fl">.2</span>)</code></pre></div>
<pre><code>## 'data.frame':    32 obs. of  3 variables:
##  $ bloco    : Factor w/ 4 levels "I","II","III",..: 1 1 1 1 1 1 1 1 2 2 ...
##  $ variedade: Factor w/ 8 levels "B 116-51","B 1-52",..: 1 2 3 4 5 6 7 8 1 2 ...
##  $ producao : num  23.1 20 12.7 18 15.4 21.1 9.2 22.6 24.2 21.1 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Tabela de frequência para os tratamentos.</span>
<span class="kw">xtabs</span>(~variedade +<span class="st"> </span>bloco, <span class="dt">data =</span> PimentelEg5<span class="fl">.2</span>)</code></pre></div>
<pre><code>##              bloco
## variedade     I II III IV
##   B 116-51    1  1   1  1
##   B 1-52      1  1   1  1
##   B 25-50 E   1  1   1  1
##   B 72-53 A   1  1   1  1
##   Buena Vista 1  1   1  1
##   Huinkul     1  1   1  1
##   Kennebec    1  1   1  1
##   S. Rafalela 1  1   1  1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Dados desempilhados.</span>
<span class="kw">t</span>(<span class="kw">unstack</span>(<span class="dt">x =</span> PimentelEg5<span class="fl">.2</span>, <span class="dt">form =</span> producao ~<span class="st"> </span>variedade))</code></pre></div>
<pre><code>##             [,1] [,2] [,3] [,4]
## B.116.51    23.1 24.2 26.4 16.3
## B.1.52      20.0 21.1 20.0 28.0
## B.25.50.E   12.7 18.0 18.2 17.1
## B.72.53.A   18.0 24.6 24.0 24.6
## Buena.Vista 15.4 11.9 10.1 12.3
## Huinkul     21.1 27.0 26.4 25.7
## Kennebec     9.2 13.4 11.0  9.2
## S..Rafalela 22.6 29.9 24.2 25.1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)

<span class="co"># Para uma melhor exibição dos dados, vamos reordenar os níveis</span>
<span class="co"># de cultivar pela média de cada uma delas. Depois vamos ordenar os</span>
<span class="co"># registros no data.frame por bloco/variedade.</span>

<span class="co"># Reordena os níveis.</span>
PimentelEg5<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">transform</span>(PimentelEg5<span class="fl">.2</span>,
                           <span class="dt">variedade =</span> <span class="kw">reorder</span>(variedade, producao))

<span class="co"># Reordena os registros.</span>
PimentelEg5<span class="fl">.2</span> &lt;-<span class="st"> </span>PimentelEg5<span class="fl">.2</span>[
    <span class="kw">with</span>(PimentelEg5<span class="fl">.2</span>, <span class="kw">order</span>(bloco, variedade)), ]

<span class="co"># Diagrama de dispersão.</span>
<span class="kw">xyplot</span>(producao ~<span class="st"> </span>variedade, <span class="dt">data =</span> PimentelEg5<span class="fl">.2</span>,
       <span class="dt">groups =</span> bloco, <span class="dt">type =</span> <span class="st">"o"</span>,
       <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">corner =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.95</span>), <span class="dt">columns =</span> <span class="dv">1</span>,
                       <span class="dt">title =</span> <span class="st">"Bloco"</span>, <span class="dt">cex.title =</span> <span class="fl">1.1</span>),
       <span class="dt">xlab =</span> <span class="st">"Variedades de batatinha (ordenadas)"</span>,
       <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="st">"Produção de batatinha"</span>~(t~ha^{-<span class="dv">1</span>})),
       <span class="dt">scales =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="kw">list</span>(<span class="dt">rot =</span> <span class="dv">90</span>)))</code></pre></div>
<p><img src="anaExpDBC_files/figure-html/unnamed-chunk-3-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Como pode ser visto na análise preliminar, o número de níveis de <code>variedade</code> é 8 e o número de blocos é 4.</p>
<p>No gráfico de dispersão, ordenamos as variedades pela média amostral e as observações de um mesmo bloco foram ligadas. Note que a relação sinal-ruído fornece uma evidência visual do efeito de variedade.</p>
<p>As observações de um mesmo blocos não foram ligadas por acaso. Nesse gráfico é possível ter impressões sob uma suposição do modelo estatístico: a aditividade dos efeitos de tratamento e bloco.</p>
</div>
<div id="especificacao-e-ajuste-do-modelo" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#especificacao-e-ajuste-do-modelo" class="anchor"> </a></body></html>Especificação e ajuste do modelo</h2>
<p>O modelo estatístico correspondente ao delineamento de blocos casualizados é</p>
<p><span class="math display">\[
\begin{aligned}
  Y|\text{bloco, variedade}
    &amp;\,\sim \text{Normal}(\mu_{ij}, \sigma^2) \newline
  \mu_{ij} &amp;= \mu + \alpha_{i} + \tau_{j},
\end{aligned}
\]</span></p>
<p>em que <span class="math inline">\(Y\)</span> é a variável resposta, <span class="math inline">\(\alpha_{i}\)</span> é o efeito do bloco <span class="math inline">\(i\)</span>, <span class="math inline">\(\tau_j\)</span> é o efeito da variedade <span class="math inline">\(j\)</span>, <span class="math inline">\(\mu\)</span> é a média de <span class="math inline">\(Y\)</span> na ausência do efeito dos blocos e da variedade e <span class="math inline">\(\sigma^2\)</span> é a variância das observações ao redor das suas respectivas médias. Note que a média (<span class="math inline">\(\mu\)</span>) tem dois índices, um referente ao bloco e outro à variedade.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#-----------------------------------------------------------------------</span>
<span class="co"># Ajuste do modelo.</span>

m0 &lt;-<span class="st"> </span><span class="kw">lm</span>(producao ~<span class="st"> </span>bloco +<span class="st"> </span>variedade, <span class="dt">data =</span> PimentelEg5<span class="fl">.2</span>)

<span class="co"># Estimativas dos efeitos. Restrição de zerar primeiro nível.</span>
<span class="kw">cbind</span>(<span class="kw">coef</span>(m0))</code></pre></div>
<pre><code>##                        [,1]
## (Intercept)           8.750
## blocoII               3.500
## blocoIII              2.275
## blocoIV               2.025
## variedadeBuena Vista  1.725
## variedadeB 25-50 E    5.800
## variedadeB 1-52      11.575
## variedadeB 116-51    11.800
## variedadeB 72-53 A   12.100
## variedadeHuinkul     14.350
## variedadeS. Rafalela 14.750</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Aqui tem-se o grupo de coeficientes para cada um dos termos do</span>
<span class="co"># preditor para a média (\mu = 0, \alpha_i = 1, \tau_j = 2).</span>
<span class="kw">split</span>(<span class="kw">coef</span>(m0), m0$assign)</code></pre></div>
<pre><code>## $`0`
## (Intercept) 
##        8.75 
## 
## $`1`
##  blocoII blocoIII  blocoIV 
##    3.500    2.275    2.025 
## 
## $`2`
## variedadeBuena Vista   variedadeB 25-50 E      variedadeB 1-52 
##                1.725                5.800               11.575 
##    variedadeB 116-51   variedadeB 72-53 A     variedadeHuinkul 
##               11.800               12.100               14.350 
## variedadeS. Rafalela 
##               14.750</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Matrizes de contrastes utilizadas, sob a retrição zerar primeiro nível.</span>
<span class="kw">contrasts</span>(PimentelEg5<span class="fl">.2</span>$bloco)</code></pre></div>
<pre><code>##     II III IV
## I    0   0  0
## II   1   0  0
## III  0   1  0
## IV   0   0  1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">contrasts</span>(PimentelEg5<span class="fl">.2</span>$variedade)</code></pre></div>
<pre><code>##             Buena Vista B 25-50 E B 1-52 B 116-51 B 72-53 A Huinkul
## Kennebec              0         0      0        0         0       0
## Buena Vista           1         0      0        0         0       0
## B 25-50 E             0         1      0        0         0       0
## B 1-52                0         0      1        0         0       0
## B 116-51              0         0      0        1         0       0
## B 72-53 A             0         0      0        0         1       0
## Huinkul               0         0      0        0         0       1
## S. Rafalela           0         0      0        0         0       0
##             S. Rafalela
## Kennebec              0
## Buena Vista           0
## B 25-50 E             0
## B 1-52                0
## B 116-51              0
## B 72-53 A             0
## Huinkul               0
## S. Rafalela           1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Médias amostrais.</span>
<span class="kw">aggregate</span>(producao ~<span class="st"> </span>variedade, <span class="dt">data =</span> PimentelEg5<span class="fl">.2</span>, <span class="dt">FUN =</span> mean)</code></pre></div>
<pre><code>##     variedade producao
## 1    Kennebec   10.700
## 2 Buena Vista   12.425
## 3   B 25-50 E   16.500
## 4      B 1-52   22.275
## 5    B 116-51   22.500
## 6   B 72-53 A   22.800
## 7     Huinkul   25.050
## 8 S. Rafalela   25.450</code></pre>
<p>No modelo estatístico para DBC, tem-se dois termos com efeito na média: os blocos e as variedades, que são os parâmetros com subíndice. Como os fatores são categóricos, <span class="math inline">\(k-1\)</span> parâmetros são estimados para acomodar o efeito de cada um (<span class="math inline">\(k\)</span> é o número de níveis). O R por padrão usa a restrição de zerar o efeito do primeiro nível de cada fator e cada coeficiente corresponde, então, à diferença entre o nível de referência e outro nível qualquer.</p>
<p>O prefixo no nome dos coeficientes vem dos correspondentes termos do modelo. O elemento <code>assign</code> mostra que foi atribuido o mesmo número inteiro para os coeficientes do mesmo termo.</p>
<p>É possível usar outra restrição ou tipo de contraste. Abaixo foi usado o contraste que zera o efeito do último nível, padrão de outro software.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m1 &lt;-<span class="st"> </span><span class="kw">update</span>(m0, <span class="dt">contrasts =</span> <span class="kw">list</span>(<span class="dt">bloco =</span> <span class="st">"contr.SAS"</span>))
<span class="kw">split</span>(<span class="kw">data.frame</span>(<span class="kw">coef</span>(m0), <span class="kw">coef</span>(m1), <span class="dt">row.names =</span> <span class="ot">NULL</span>), m0$assign)</code></pre></div>
<pre><code>## $`0`
##   coef.m0. coef.m1.
## 1     8.75   10.775
## 
## $`1`
##   coef.m0. coef.m1.
## 2    3.500   -2.025
## 3    2.275    1.475
## 4    2.025    0.250
## 
## $`2`
##    coef.m0. coef.m1.
## 5     1.725    1.725
## 6     5.800    5.800
## 7    11.575   11.575
## 8    11.800   11.800
## 9    12.100   12.100
## 10   14.350   14.350
## 11   14.750   14.750</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Médias ajustadas de mínimos quadrados (least squares means).</span>
<span class="co"># L &lt;- doBy::LSmatrix(m1, effect = "variedade")</span>
L &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>),
            <span class="dt">byrow =</span> <span class="ot">TRUE</span>,
            <span class="dt">nrow =</span> <span class="kw">nlevels</span>(PimentelEg5<span class="fl">.2</span>$variedade),
            <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="kw">levels</span>(PimentelEg5<span class="fl">.2</span>$variedade), <span class="ot">NULL</span>))

L %*%<span class="st"> </span><span class="kw">coef</span>(m1)</code></pre></div>
<pre><code>##               [,1]
## Kennebec    10.700
## Buena Vista 12.425
## B 25-50 E   16.500
## B 1-52      22.275
## B 116-51    22.500
## B 72-53 A   22.800
## Huinkul     25.050
## S. Rafalela 25.450</code></pre>
<p>O interesse nesse experimento é estudar o efeito das variedades. No entanto, no modelo tem-se também o efeito dos blocos, que foram incluídos para efeito de controle local. Uma maneira de representar o efeito das variedades é calcular as médias ajustadas, ao invés de considerar os coeficientes estimados. Ajustar, no caso, é considerar que para cada termo fora de interesse, os efeitos terão como peso o inverso do número de níveis. Sendo assim, com 4 blocos os pesos são 1/4, ou seja, cada bloco contribui com 1/4 do seu efeito. Perceba que isso é exatamente uma média de efeitos. Apesar da simplicidade, esse tipo de média ficou conhecida por <em>lsmeans</em> (Least Squares Means).</p>
</div>
<div id="avaliacao-dos-pressupostos" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#avaliacao-dos-pressupostos" class="anchor"> </a></body></html>Avaliação dos pressupostos</h2>
<p>Além das suposições de normalidade e homogeneidade de variâncias, no modelo para DBC tem-se que o efeito dos blocos e das variedades é aditivo. Ou seja, espera-se que ao mudar de bloco as médias das diferentes variedades sejam deslocadas em igual quantidade. Mas há situações em que isso pode não acontecer. Por exemplo, imagine um experimento de competição de cultivares em que existem blocos pouco férteis e muito férteis. Pode acontecer que no bloco fértil exista praticamente nunhuma diferença entre as cultivares, já que o ambiente é favorável. No bloco pouco fértil, por outro lado, as cultivares melhor adaptadas à baixa fertilidade podem apresentar produção superior. Em outras palavras, nesse cenário o bloco interage com as cultivares, pois as diferenças entre elas é influenciada pelos blocos. O modelo estatístico assume aditividade e, por isso, cabe na hora do planejamento perceber se a característica blocada (fertilidade) pode influenciar no efeito sendo estudado (cultivares). Em caso afirmativo, poder-se-ia procurar uma área experimental uniforme em fertilidade (de preferência, nesse caso, de baixa fertilidade) para permitir distinguir as cultivares.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#-----------------------------------------------------------------------</span>
<span class="co"># Exibe o quarteto fantástico da avaliação dos pressupostos.</span>

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(m0); <span class="kw">layout</span>(<span class="dv">1</span>)</code></pre></div>
<p><img src="anaExpDBC_files/figure-html/unnamed-chunk-6-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Os gráficos de resíduos não apresentam evidências para o fuga dos pressupostos. O gráfico 2-1 (Scale-Location) mostra que a dispersão dos valores é a mesma independente da média. O gráfico 1-2 (Normal Q-Q) mostra que os pontos não fogem acentuadamente uma reta, indicando que a suposição de normalidade dos erros foi atendida.</p>
<p>O teste de Tukey para não aditividade foi proposto por Tukey em 1949 com a finalidade de verificar se dois termos tem efeitos aditivos. Não é o objetivo dessa vinheta entrar em detalhes sobre os fundamentos do teste.</p>
<p>No R há ao menos 3 pacotes com funções para fazer o teste de aditividade de Tukey: <a href="http://www.inside-r.org/packages/cran/agricolae/docs/nonadditivity"><code>agricolae::nonadditivity()</code></a>, <a href="http://www.inside-r.org/packages/cran/asbio/docs/tukey.add.test"><code>asbio::tukey.add.test()</code></a> e <a href="(http://www.inside-r.org/packages/cran/additivityTests/docs/tukey.test"><code>addititivityTests::tukey.test()</code></a>. No entanto, esse teste pode ser feito sem chamar pacotes, conforme ilustramos abaixo.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#-----------------------------------------------------------------------</span>
<span class="co"># Teste da aditividade bloco x tratamento.</span>

X &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(m0)
beta &lt;-<span class="st"> </span><span class="kw">coef</span>(m0)
a &lt;-<span class="st"> </span>m0$assign
aditiv &lt;-<span class="st"> </span>X[, a ==<span class="st"> </span><span class="dv">1</span>] %*%<span class="st"> </span>beta[a ==<span class="st"> </span><span class="dv">1</span>] *<span class="st"> </span>X[, a ==<span class="st"> </span><span class="dv">2</span>] %*%<span class="st"> </span>beta[a ==<span class="st"> </span><span class="dv">2</span>]

<span class="kw">anova</span>(<span class="kw">update</span>(m0, . ~<span class="st"> </span>. +<span class="st"> </span>aditiv))</code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: producao
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## bloco      3  50.53  16.843  2.0223    0.1432    
## variedade  7 919.72 131.389 15.7755 7.007e-07 ***
## aditiv     1  12.89  12.892  1.5479    0.2278    
## Residuals 20 166.57   8.329                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Pacote agricolae possuí função para o teste da aditividade.</span>
<span class="co"># agricolae::nonadditivity(y = PimentelEg5.2$prod,</span>
<span class="co">#                          factor1 = PimentelEg5.2$bloco,</span>
<span class="co">#                          factor2 = PimentelEg5.2$variedade,</span>
<span class="co">#                          df = df.residual(m0),</span>
<span class="co">#                          MSerror = deviance(m0)/df.residual(m0))</span></code></pre></div>
<p>Pelo resultado do teste não rejeitamos a hipótese de que os efeitos de blocos e variedades são aditivos. Para detalhes sobre o teste da aditividade visite <a href="http://www.ime.usp.br/~botter/mae327/Blocos/Blocos.pdf" class="uri">http://www.ime.usp.br/~botter/mae327/Blocos/Blocos.pdf</a>, página 20.</p>
</div>
<div id="inferencias" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#inferencias" class="anchor"> </a></body></html>Inferências</h2>
<p>O efeito das variedades é representado pelos coeficientes <span class="math inline">\(\tau_j\)</span> no modelo estatístico do experimento. Se não existe efeito das variedades, os valores estimados <span class="math inline">\(\tau_{i}\)</span> serão próximos a zero. A hipóteses nula de não haver efeito é representada por</p>
<p><span class="math display">\[
  \text{H}_{0}: \tau_j = 0, \text{para todo}\,j.
\]</span></p>
<p>Essa hipótese é avaliada pelo estatística F do quadro de análise de variância.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(m0)</code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: producao
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## bloco      3  50.53  16.843  1.9709    0.1493    
## variedade  7 919.72 131.389 15.3744 5.723e-07 ***
## Residuals 21 179.47   8.546                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Pelo quadro, existe efeito das variedades, ou seja, elas não apresentam a mesma produção média. Os códigos abaixo retornam os valores preditos para as variedades sob efeito do bloco I. Ou seja, esses são os valores esperados de produção para as variedades cultivadas no bloco I. Se outro bloco for considerado, os valores médios serão diferentes devido à mudança no efeito do bloco. No entanto, é importante enfatizar que as diferenças entre as médias das variedades é a mesma, independente do bloco considerado. Portanto, como o interesse está na diferença entre médias, tanto faz o bloco escolhido.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Predição das médias das variades no bloco I.</span>
pred &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">variedade =</span> <span class="kw">levels</span>(PimentelEg5<span class="fl">.2</span>$variedade),
                   <span class="dt">bloco =</span> <span class="st">"I"</span>)
pred &lt;-<span class="st"> </span><span class="kw">cbind</span>(pred,
              <span class="kw">as.data.frame</span>(<span class="kw">predict</span>(m0,
                                    <span class="dt">newdata =</span> pred,
                                    <span class="dt">interval =</span> <span class="st">"confidence"</span>)))
pred$variedade &lt;-<span class="st"> </span><span class="kw">reorder</span>(pred$variedade, pred$fit)
pred</code></pre></div>
<pre><code>##     variedade bloco    fit       lwr      upr
## 1    Kennebec     I  8.750  5.185618 12.31438
## 2 Buena Vista     I 10.475  6.910618 14.03938
## 3   B 25-50 E     I 14.550 10.985618 18.11438
## 4      B 1-52     I 20.325 16.760618 23.88938
## 5    B 116-51     I 20.550 16.985618 24.11438
## 6   B 72-53 A     I 20.850 17.285618 24.41438
## 7     Huinkul     I 23.100 19.535618 26.66438
## 8 S. Rafalela     I 23.500 19.935618 27.06438</code></pre>
<p>Se por um lado a escolha do bloco não altera a diferença entre médias, por outro, existe preferência por considerar não o efeito de um bloco qualquer, mas sim o efeito médio de todos. São duas as principais vantagens: 1) com o efeito médio dos blocos o erro padrão das médias é menor e 2) considerando que efeito dos blocos vem de uma distribuição de probabilidades, usar a média dos efeitos tem uma interpretação interessante. Por exemplo, se os blocos controlam as variações de fertilidade do solo, ao considerar a média do efeito dos blocos tem-se as produtividades médias das variedades ao longo dessas condições de fertilidade (férteis, normais, ruins). Embora o objetivo do experimento seja estudar a diferença entre as variedades, o pesquisador tem necessidade de reportar um número que indique, de alguma forma, a previsão de desempenho futuro.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(multcomp, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))

<span class="co"># Vetor de pesos para o valor esperado da variedade 1 no bloco I e na</span>
<span class="co"># média dos blocos.</span>
l1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>,    <span class="dv">0</span>,    <span class="dv">0</span>,    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">nrow =</span> <span class="dv">1</span>)
l0 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">nrow =</span> <span class="dv">1</span>)

<span class="co"># Os erros padrões também são diferentes, assim como as médias.</span>
<span class="kw">summary</span>(<span class="kw">glht</span>(m0, <span class="dt">linfct =</span> l1))</code></pre></div>
<pre><code>## 
##   Simultaneous Tests for General Linear Hypotheses
## 
## Fit: lm(formula = producao ~ bloco + variedade, data = PimentelEg5.2)
## 
## Linear Hypotheses:
##        Estimate Std. Error t value Pr(&gt;|t|)    
## 1 == 0    8.750      1.714   5.105 4.68e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## (Adjusted p values reported -- single-step method)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(<span class="kw">glht</span>(m0, <span class="dt">linfct =</span> l0))</code></pre></div>
<pre><code>## 
##   Simultaneous Tests for General Linear Hypotheses
## 
## Fit: lm(formula = producao ~ bloco + variedade, data = PimentelEg5.2)
## 
## Linear Hypotheses:
##        Estimate Std. Error t value Pr(&gt;|t|)    
## 1 == 0   10.700      1.462    7.32 3.32e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## (Adjusted p values reported -- single-step method)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Erros-padrões obtidos matricialmente.</span>
<span class="co"># sqrt(l1 %*% vcov(m0) %*% t(l1))</span>
<span class="co"># sqrt(l0 %*% vcov(m0) %*% t(l0))</span>

<span class="co"># A prova de que a variância do efeito de bloco não contribui para a</span>
<span class="co"># variância da média quando se usa a média dos blocos.</span>
<span class="kw">round</span>(<span class="kw">data.frame</span>(<span class="st">"bloco I"</span> =<span class="st"> </span><span class="kw">t</span>(l1 %*%<span class="st"> </span><span class="kw">vcov</span>(m0)),
                 <span class="st">"média"</span> =<span class="st"> </span><span class="kw">t</span>(l0 %*%<span class="st"> </span><span class="kw">vcov</span>(m0))), <span class="dv">5</span>)</code></pre></div>
<pre><code>##                       bloco.I    média
## (Intercept)           2.93767  2.13649
## blocoII              -1.06824  0.00000
## blocoIII             -1.06824  0.00000
## blocoIV              -1.06824  0.00000
## variedadeBuena Vista -2.13649 -2.13649
## variedadeB 25-50 E   -2.13649 -2.13649
## variedadeB 1-52      -2.13649 -2.13649
## variedadeB 116-51    -2.13649 -2.13649
## variedadeB 72-53 A   -2.13649 -2.13649
## variedadeHuinkul     -2.13649 -2.13649
## variedadeS. Rafalela -2.13649 -2.13649</code></pre>
<p>O código acima mostra que ao considerar a médias dos blocos o erro-padrão foi menor. Isso porque na média dos blocos, os efeitos dos blocos se anulam e por isso o erro-padrão da estimativa do efeito dos blocos é 0 e não contribui pro erro-padrão da estimativa dos efeitos das variedades.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># IC *individual* de cobertura 95%.</span>
<span class="co"># ic &lt;- confint(glht(m0, linfct = L), calpha = univariate_calpha())</span>
<span class="co"># ic &lt;- as.data.frame(ic$confint)</span>

<span class="co"># IC *global* de cobertura 95%. CUIDADO, essa função demora muito quando</span>
<span class="co"># o número de níveis é grande.</span>
ic &lt;-<span class="st"> </span><span class="kw">confint</span>(<span class="kw">glht</span>(m0, <span class="dt">linfct =</span> L))
ic &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(ic$confint)

<span class="kw">names</span>(ic) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"fit"</span>, <span class="st">"lwr"</span>, <span class="st">"upr"</span>)

pred &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">variedade =</span> pred$variedade, ic)
pred</code></pre></div>
<pre><code>##               variedade    fit       lwr      upr
## Kennebec       Kennebec 10.700  6.307209 15.09279
## Buena Vista Buena Vista 12.425  8.032209 16.81779
## B 25-50 E     B 25-50 E 16.500 12.107209 20.89279
## B 1-52           B 1-52 22.275 17.882209 26.66779
## B 116-51       B 116-51 22.500 18.107209 26.89279
## B 72-53 A     B 72-53 A 22.800 18.407209 27.19279
## Huinkul         Huinkul 25.050 20.657209 29.44279
## S. Rafalela S. Rafalela 25.450 21.057209 29.84279</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(latticeExtra)

<span class="kw">segplot</span>(variedade ~<span class="st"> </span>lwr +<span class="st"> </span>upr, <span class="dt">centers =</span> fit, <span class="dt">data =</span> pred,
        <span class="dt">draw =</span> <span class="ot">FALSE</span>, <span class="dt">horizontal =</span> <span class="ot">FALSE</span>,
        <span class="dt">xlab =</span> <span class="st">"Variedades de batatinha"</span>,
        <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="st">"Produção de batatinha"</span>~(t~ha^{-<span class="dv">1</span>})),
        <span class="dt">scales =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="kw">list</span>(<span class="dt">rot =</span> <span class="dv">90</span>)),
        <span class="dt">panel =</span> function(x, y, z, centers, ...) {
            <span class="kw">panel.segplot</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z, <span class="dt">centers =</span> centers, ...)
            <span class="kw">panel.text</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(z), <span class="dt">y =</span> centers,
                       <span class="dt">label =</span> <span class="kw">sprintf</span>(<span class="st">"%0.2f"</span>, centers),
                       <span class="dt">srt =</span> <span class="dv">90</span>, <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">adj =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, -<span class="fl">0.5</span>))
        })</code></pre></div>
<p><img src="anaExpDBC_files/figure-html/unnamed-chunk-11-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Por fim, uma representação intessante é colocar as médias ajustadas das variades com alguma presentação de incerteza, como o intervalo de confiança. No caso, foi usando o intervalo de confiança com cobertura global de 95%. Os intervalos de cobertura individual são aqueles cuja probabilidade de conter o parâmetro é <span class="math inline">\(\gama\)</span> para cada coeficiente separadamente. Já o de confiança global, a probabilidade <span class="math inline">\(\gama\)</span> é a de todos os intervalores conterem os parâmetros simultaneamente. Esses intervalos são mais amplos (menos precisos) que os de cobertura individual.</p>
</div>
<div id="gerando-experimento-em-dbc" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#gerando-experimento-em-dbc" class="anchor"> </a></body></html>Gerando experimento em DBC</h2>
<p>A casualização em um experimento em delineamento de blocos casualizados é feita dentro de cada bloco. O código abaixo produz um sorteio considerando a mesma estrutra do conjunto de dados analisado.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">replicate</span>(<span class="kw">nlevels</span>(PimentelEg5<span class="fl">.2</span>$bloco),
          <span class="kw">sample</span>(<span class="kw">levels</span>(PimentelEg5<span class="fl">.2</span>$variedade)))</code></pre></div>
<pre><code>##      [,1]          [,2]          [,3]          [,4]         
## [1,] "S. Rafalela" "S. Rafalela" "B 116-51"    "Buena Vista"
## [2,] "Kennebec"    "Huinkul"     "B 25-50 E"   "Kennebec"   
## [3,] "Huinkul"     "B 25-50 E"   "Kennebec"    "B 116-51"   
## [4,] "B 72-53 A"   "Kennebec"    "S. Rafalela" "S. Rafalela"
## [5,] "B 1-52"      "Buena Vista" "B 1-52"      "Huinkul"    
## [6,] "B 116-51"    "B 1-52"      "Buena Vista" "B 25-50 E"  
## [7,] "B 25-50 E"   "B 116-51"    "B 72-53 A"   "B 72-53 A"  
## [8,] "Buena Vista" "B 72-53 A"   "Huinkul"     "B 1-52"</code></pre>
</div>
<div id="informacoes-da-sessao" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#informacoes-da-sessao" class="anchor"> </a></body></html>Informações da sessão</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.3.2 (2016-10-31)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu precise (12.04.5 LTS)
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets 
## [7] base     
## 
## other attached packages:
##  [1] multcomp_1.4-6       TH.data_1.0-8        MASS_7.3-45         
##  [4] survival_2.39-5      mvtnorm_1.0-6        knitr_1.15.1        
##  [7] vcd_1.4-3            reshape_0.8.6        car_2.1-4           
## [10] qcc_2.6              reshape2_1.4.2       ggplot2_2.2.1       
## [13] latticeExtra_0.6-28  RColorBrewer_1.1-2   lattice_0.20-34     
## [16] labestData_0.1-1.462
## 
## loaded via a namespace (and not attached):
##  [1] zoo_1.7-14         purrr_0.2.2        splines_3.3.2     
##  [4] colorspace_1.3-2   htmltools_0.3.5    yaml_2.1.14       
##  [7] mgcv_1.8-15        pkgdown_0.1.0.9000 nloptr_1.0.4      
## [10] withr_1.0.2        plyr_1.8.4         stringr_1.2.0     
## [13] MatrixModels_0.4-1 munsell_0.4.3      commonmark_1.2    
## [16] gtable_0.2.0       devtools_1.12.0    codetools_0.2-15  
## [19] memoise_1.0.0      evaluate_0.10      labeling_0.3      
## [22] SparseM_1.76       highlight_0.4.7    lmtest_0.9-35     
## [25] quantreg_5.29      pbkrtest_0.4-6     parallel_3.3.2    
## [28] methods_3.3.2      Rcpp_0.12.9        scales_0.4.1      
## [31] backports_1.0.5    desc_1.1.0         pkgload_0.0.0.9000
## [34] lme4_1.1-12        digest_0.6.12      stringi_1.1.2     
## [37] rprojroot_1.2      tools_3.3.2        sandwich_2.3-4    
## [40] magrittr_1.5       lazyeval_0.2.0     tibble_1.2        
## [43] crayon_1.3.2       whisker_0.3-2      Matrix_1.2-7.1    
## [46] xml2_1.1.1         assertthat_0.1     minqa_1.2.4       
## [49] rmarkdown_1.3.9004 roxygen2_6.0.1     R6_2.2.0          
## [52] nnet_7.3-12        nlme_3.1-128</code></pre>
<!------------------------------------------- -->
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#analise-exploratoria">Análise exploratória</a></li>
      <li><a href="#especificacao-e-ajuste-do-modelo">Especificação e ajuste do modelo</a></li>
      <li><a href="#avaliacao-dos-pressupostos">Avaliação dos pressupostos</a></li>
      <li><a href="#inferencias">Inferências</a></li>
      <li><a href="#gerando-experimento-em-dbc">Gerando experimento em DBC</a></li>
      <li><a href="#informacoes-da-sessao">Informações da sessão</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by PET Estatística UFPR.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
