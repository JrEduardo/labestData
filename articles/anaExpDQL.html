<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Análise de Experimentos em Delineamento Quadrado Latino • labestData</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">labestData</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/index.html">Vinhetas</a>
</li>
<li>
  <a href="../references/index.html">Datasets</a>
</li>
<li>
  <a href="../references/index.html">Funções</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Análise de Experimentos em Delineamento Quadrado Latino</h1>
                        <h4 class="author">PET Estatística UFPR</h4>
            
          </div>

    
    
<div class="contents">
<div id="analise-exploratoria" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#analise-exploratoria" class="anchor"> </a></body></html>Análise exploratória</h2>
<p>Para exemplificação da análise de um experimento em delineamento quadrado latino (DQL), vamos considerar o conjunto de dados <code>StorckEg2.3.5</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(labestData)

<span class="co"># Selecione a keyword DQL para filtrar os experimentos em DQL.</span>
<span class="co"># labestDataView()</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">help</span>(StorckEg2<span class="fl">.3.5</span>, <span class="dt">help_type =</span> <span class="st">"html"</span>)</code></pre></div>
<p>Nesse experimento estudou-se o rendimento (resposta) de quatro cultivares de alho. O experimento foi instalado em delineamento quadrado latino para ser feito controle local em duas dimensões. A blocagem nas linhas foi em razão da heterogeneidade da fertilidade entre as curvas de nível (cada curva igual a uma linha) e a blocagem nas colunas foi devido à heterogeneidade entre os tamanhos dos bulbos de alho, portanto, em cada coluna foi usado uma classe de tamanho de bulbos.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#-----------------------------------------------------------------------</span>
<span class="co"># Ler a partir do repositório do labestData.</span>

<span class="co"># url &lt;- paste0("https://gitlab.c3sl.ufpr.br/pet-estatistica",</span>
<span class="co">#               "/labestData/raw/devel/data-raw/StorckEg2.3.5.txt")</span>
<span class="co">#</span>
<span class="co"># StorckEg2.3.5 &lt;- read.table(file = url, sep = "\t", header = TRUE)</span>

<span class="co">#-----------------------------------------------------------------------</span>
<span class="co"># Análise exploratória.</span>

<span class="co"># Estrutura do objeto.</span>
<span class="kw">str</span>(StorckEg2<span class="fl">.3.5</span>)</code></pre></div>
<pre><code>## 'data.frame':    16 obs. of  4 variables:
##  $ fila : Factor w/ 4 levels "1","2","3","4": 1 1 1 1 2 2 2 2 3 3 ...
##  $ colun: Factor w/ 4 levels "1","2","3","4": 1 2 3 4 1 2 3 4 1 2 ...
##  $ cult : Factor w/ 4 levels "A","B","C","D": 2 4 1 3 1 3 4 2 4 2 ...
##  $ rend : int  11 4 7 15 12 9 7 9 8 7 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Tabela de frequência para os tratamentos.</span>
<span class="kw">xtabs</span>(~cult, <span class="dt">data =</span> StorckEg2<span class="fl">.3.5</span>)</code></pre></div>
<pre><code>## cult
## A B C D 
## 4 4 4 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Dados desempilhados.</span>
<span class="kw">unstack</span>(<span class="dt">x =</span> StorckEg2<span class="fl">.3.5</span>, <span class="dt">form =</span> rend ~<span class="st"> </span>cult)</code></pre></div>
<pre><code>##    A  B  C  D
## 1  7 11 15  4
## 2 12  9  9  7
## 3  5  7 12  8
## 4  7 12 17 10</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reshape)

<span class="co"># Croqui do delineamento (em texto).</span>
<span class="kw">cast</span>(StorckEg2<span class="fl">.3.5</span>, fila ~<span class="st"> </span>colun, <span class="dt">value =</span> <span class="st">"cult"</span>)</code></pre></div>
<pre><code>##   fila 1 2 3 4
## 1    1 B D A C
## 2    2 A C D B
## 3    3 D B C A
## 4    4 C A B D</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Croqui do delineamento (em gráfico).</span>
<span class="kw">levelplot</span>(rend ~<span class="st"> </span>fila +<span class="st"> </span>colun,
          <span class="dt">data =</span> StorckEg2<span class="fl">.3.5</span>, <span class="dt">aspect =</span> <span class="st">"iso"</span>,
          <span class="dt">col.regions =</span> heat.colors,
          <span class="dt">xlab =</span> <span class="st">"Blocagem das curvas de nível"</span>,
          <span class="dt">ylab =</span> <span class="st">"Blocagem dos tamanhos de bulbo"</span>,
          <span class="dt">panel =</span> function(x, y, z, subscripts, ...) {
              <span class="kw">panel.levelplot</span>(x, y, z, <span class="dt">subscripts =</span> subscripts, ...)
              <span class="kw">panel.text</span>(x, y, StorckEg2<span class="fl">.3.5</span>$cult[subscripts],
                         <span class="dt">cex =</span> <span class="fl">0.8</span>)
              <span class="kw">panel.text</span>(x, y, z, <span class="dt">pos =</span> <span class="dv">1</span>)
          })</code></pre></div>
<p><img src="anaExpDQL_files/figure-html/unnamed-chunk-3-1.png" width="600" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)

<span class="co"># Diagrama de dispersão dos valores. Cores identificam as colunas e</span>
<span class="co"># símbolos identificam as filas.</span>
<span class="kw">xyplot</span>(rend ~<span class="st"> </span><span class="kw">reorder</span>(cult, rend),
       <span class="dt">data =</span> StorckEg2<span class="fl">.3.5</span>,
       <span class="dt">pch =</span> StorckEg2<span class="fl">.3.5</span>$fila,
       <span class="dt">col =</span> StorckEg2<span class="fl">.3.5</span>$colun,
       <span class="dt">xlab =</span> <span class="st">"Cultivares de alho"</span>,
       <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="st">"Rendimento"</span> ~<span class="st"> </span>(ton ~<span class="st"> </span>ha^{-<span class="dv">1</span>})),
       <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">"p"</span>, <span class="st">"a"</span>))</code></pre></div>
<p><img src="anaExpDQL_files/figure-html/unnamed-chunk-3-2.png" width="600" style="display: block; margin: auto;"></p>
<p>Conforme a análise preliminar, esse quadrado latino é de dimensão 4.</p>
<p>No gráfico de dispersão, ordenamos as cultivares pela média amostral e as observações de uma mesma fila e coluna foram identificadas com símbolos e cores, respectivamente. Pelo diagrama de dispersão, os pontos em preto tem a tendência de seres os mais altos enquanto que os vermelhos são os mais baixos. Já para os símbolos, a cruz diagonal (<span class="math inline">\(\times\)</span>) apresenta rendimentos mais elevados e a cruz vertical (<span class="math inline">\(+\)</span>) rendimentos menores.</p>
<p>A variável resposta rendimento, nesse experimento, está representada em toneladas por hectare. Apesar de ser uma variável contínua, todos os valores observados são inteiros. Dificilmente o instrumento de medida usado no experimento tenha uma precisão tão pequena. Provavelmente os resultados tenham maior precisão mas foram arredondados para inteiros para facilitar a execução da análise sem computador.</p>
</div>
<div id="especificacao-e-ajuste-do-modelo" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#especificacao-e-ajuste-do-modelo" class="anchor"> </a></body></html>Especificação e ajuste do modelo</h2>
<p>O modelo estatístico correspondente ao delineamento quadrado latino é</p>
<p><span class="math display">\[
\begin{aligned}
  Y \mid \text{fila, colun, cult}
    &amp;\,\sim \text{Normal}(\mu_{ijk}, \sigma^2) \newline
  \mu_{ijk} &amp;= \mu + \alpha_{i} + \gamma_{j} + \tau_{k},
\end{aligned}
\]</span></p>
<p>em que <span class="math inline">\(Y\)</span> é a variável resposta, <span class="math inline">\(\alpha_{i}\)</span> é o efeito da fila <span class="math inline">\(i\)</span>, <span class="math inline">\(\gamma_j\)</span> é o efeito da coluna <span class="math inline">\(j\)</span>, <span class="math inline">\(\tau_k\)</span> é o efeito da cultivar <span class="math inline">\(k\)</span>, <span class="math inline">\(\mu\)</span> é a média de <span class="math inline">\(Y\)</span> na ausência do efeito de todos os termos indexados e <span class="math inline">\(\sigma^2\)</span> é a variância das observações ao redor das suas respectivas médias. Note que o parâmetro de média (<span class="math inline">\(\mu\)</span>) da distribuição Normal assumida aos dados, tem três índices referentes à fila, coluna e cultivar.</p>
<p>Antes de declararmos o modelo, é importante notar que as variáveis <code>fila</code> e <code>colun</code> precisam ser convertidas para fator (variável qualitativa) para fazer a análise. Da forma como estão, serão interpretadas como fatores quantitativos para os quais será estimado um coeficiente de taxa, o que é inadequado.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Transforma os dados.
StorckEg2<span class="fl">.3.5</span> &lt;-<span class="st"> </span><span class="kw">transform</span>(StorckEg2<span class="fl">.3.5</span>,
                           <span class="dt">fila =</span> <span class="kw">factor</span>(fila),
                           <span class="dt">colun =</span> <span class="kw">factor</span>(colun))
<span class="kw">str</span>(StorckEg2<span class="fl">.3.5</span>)</code></pre></div>
<pre><code>## 'data.frame':    16 obs. of  4 variables:
##  $ fila : Factor w/ 4 levels "1","2","3","4": 1 1 1 1 2 2 2 2 3 3 ...
##  $ colun: Factor w/ 4 levels "1","2","3","4": 1 2 3 4 1 2 3 4 1 2 ...
##  $ cult : Factor w/ 4 levels "A","B","C","D": 2 4 1 3 1 3 4 2 4 2 ...
##  $ rend : int  11 4 7 15 12 9 7 9 8 7 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#-----------------------------------------------------------------------</span>
<span class="co"># Ajuste do modelo.</span>
m0 &lt;-<span class="st"> </span><span class="kw">lm</span>(rend ~<span class="st"> </span>fila +<span class="st"> </span>colun +<span class="st"> </span>cult, <span class="dt">data =</span> StorckEg2<span class="fl">.3.5</span>)

<span class="co"># Estimativas dos efeitos. Restrição de zerar primeiro nível.</span>
<span class="kw">cbind</span>(<span class="kw">coef</span>(m0))</code></pre></div>
<pre><code>##                      [,1]
## (Intercept)  1.000000e+01
## fila2        5.768888e-16
## fila3       -1.250000e+00
## fila4        2.250000e+00
## colun2      -5.250000e+00
## colun3      -2.500000e+00
## colun4      -2.250000e+00
## cultB        2.000000e+00
## cultC        5.500000e+00
## cultD       -5.000000e-01</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Aqui tem-se o grupo de coeficientes para cada um dos termos do</span>
<span class="co"># preditor para a média (\mu = 0, \alpha_i = 1, \gamma_j = 2,</span>
<span class="co"># \tau_k = 3).</span>
<span class="kw">split</span>(<span class="kw">coef</span>(m0), m0$assign)</code></pre></div>
<pre><code>## $`0`
## (Intercept) 
##          10 
## 
## $`1`
##         fila2         fila3         fila4 
##  5.768888e-16 -1.250000e+00  2.250000e+00 
## 
## $`2`
## colun2 colun3 colun4 
##  -5.25  -2.50  -2.25 
## 
## $`3`
## cultB cultC cultD 
##   2.0   5.5  -0.5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Médias amostrais.</span>
<span class="kw">aggregate</span>(rend ~<span class="st"> </span>cult, <span class="dt">data =</span> StorckEg2<span class="fl">.3.5</span>, <span class="dt">FUN =</span> mean)</code></pre></div>
<pre><code>##   cult  rend
## 1    A  7.75
## 2    B  9.75
## 3    C 13.25
## 4    D  7.25</code></pre>
<p>No modelo estatístico para DQL, tem-se três termos com efeito na média: filas, colunas e cultivares, que são os parâmetros indexados no modelo. Como os fatores são categóricos, <span class="math inline">\(k-1\)</span> parâmetros são estimados para acomodar o efeito de cada um (<span class="math inline">\(k\)</span> representa o número de níveis). O R por padrão usa a restrição de zerar o efeito do primeiro nível de cada fator e, assim, cada coeficiente corresponde à diferença entre o nível de referência e cada um dos demais.</p>
<p>O prefixo no nome dos coeficientes vem dos correspondentes termos do modelo. O elemento <code>assign</code> mostra que foi atribuído o mesmo número inteiro para os coeficientes do mesmo termo (0 para o termo <span class="math inline">\(\mu\)</span>, 1 para os <span class="math inline">\(\alpha_i\)</span>, 2 para os <span class="math inline">\(\gamma_j\)</span> e 3 para os <span class="math inline">\(\tau_k\)</span>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Médias ajustadas de mínimos quadrados (least squares means).</span>
<span class="co"># L &lt;- doBy::LSmatrix(m0, effect = "cult")</span>
<span class="co"># dput(L)</span>
<span class="kw">dput</span>(<span class="kw">t</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>,
              <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>,
              <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,
              <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>),
            <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> <span class="ot">FALSE</span>)))</code></pre></div>
<pre><code>## structure(c(1, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0, 0, 0, 1, 
## 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 1, 0, 0, 1, 0.25, 0.25, 0.25, 
## 0.25, 0.25, 0.25, 0, 1, 0, 1, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 
## 0, 0, 1), .Dim = c(10L, 4L))</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">L &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>,
              <span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>),
            <span class="dt">byrow =</span> <span class="ot">TRUE</span>,
            <span class="dt">nrow =</span> <span class="kw">nlevels</span>(StorckEg2<span class="fl">.3.5</span>$cult),
            <span class="dt">dimnames =</span> <span class="kw">list</span>(<span class="kw">levels</span>(StorckEg2<span class="fl">.3.5</span>$cult), <span class="ot">NULL</span>))

<span class="co"># Médias de mínimos quadrados.</span>
L %*%<span class="st"> </span><span class="kw">coef</span>(m0)</code></pre></div>
<pre><code>##    [,1]
## A  7.75
## B  9.75
## C 13.25
## D  7.25</code></pre>
<p>O interesse nesse experimento é estudar o efeito das cultivares de alho. No entanto, no modelo tem-se também o efeito de filas e colunas, que foram incluídos para controle local. Uma maneira de representar o efeito das cultivares é calcular as médias ajustadas, ao invés de reportar os coeficientes estimados. Para cálculo das médias, considera-se para cada termo que não seja de interesse, que seus efeitos contribuam com peso igual ao inverso do número de níveis. Sendo assim, com 4 filas e 4 colunas os pesos são 1/4, ou seja, cada nível contribui com 1/4 do seu efeito estimado. Perceba que isso é exatamente uma média de efeitos. Apesar da simplicidade, esse tipo de média ficou conhecida por <em>lsmeans</em> (Least Squares Means).</p>
</div>
<div id="avaliacao-dos-pressupostos" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#avaliacao-dos-pressupostos" class="anchor"> </a></body></html>Avaliação dos pressupostos</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#-----------------------------------------------------------------------</span>
<span class="co"># Exibe o quarteto fantástico da avaliação dos pressupostos.</span>

<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))
<span class="kw">plot</span>(m0); <span class="kw">layout</span>(<span class="dv">1</span>)</code></pre></div>
<p><img src="anaExpDQL_files/figure-html/unnamed-chunk-6-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Os gráficos de resíduos não apresentam evidências para o fuga dos pressupostos. O gráfico 2-1 (Scale-Location) mostra que a dispersão dos valores é a mesma independente da média. O gráfico 1-2 (Normal Q-Q) mostra que os pontos não fogem acentuadamente uma reta, indicando que a suposição de normalidade dos erros foi atendida. Deve-se considerar que o número de observações é pequeno, portanto, o reconhecimento de padrões é muito difícil.</p>
</div>
<div id="inferencias" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#inferencias" class="anchor"> </a></body></html>Inferências</h2>
<p>O efeito das variedades é representado pelos coeficientes <span class="math inline">\(\tau_k\)</span> no modelo estatístico do experimento. Se não existe efeito das variedades, os valores estimados <span class="math inline">\(\tau_{k}\)</span> serão simultaneamente próximos a zero. A hipóteses nula de não haver efeito é representada por</p>
<p><span class="math display">\[
  \text{H}_{0}: \tau_k = 0, \text{para todo}\,k.
\]</span></p>
<p>Essa hipótese é avaliada pelo estatística F do quadro de análise de variância.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(m0)</code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: rend
##           Df Sum Sq Mean Sq F value   Pr(&gt;F)   
## fila       3   25.5  8.5000  3.1875 0.105554   
## colun      3   55.5 18.5000  6.9375 0.022354 * 
## cult       3   89.0 29.6667 11.1250 0.007283 **
## Residuals  6   16.0  2.6667                    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Pelo quadro, existe efeito das cultivares (<span class="math inline">\(p&lt;0.05\)</span>), ou seja, elas não apresentam a mesma produção média. Os códigos abaixo retornam os valores preditos para as cultivares sob efeito do primeiro nível de fila e de coluna, ou seja, esses são os valores esperados de rendimento para as cultivares nessas condições. Se outras filas ou colunas forem consideradas, os valores médios serão diferentes devido à mudança no valor desses efeitos. No entanto, é importante enfatizar que as diferenças entre as médias das cultivares permanecerá a mesma, independente da escolha de fila ou coluna. Portanto, como o interesse está na diferença entre médias para cultivares, não importa em quais níveis estão fixados os valores dos demais termos.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Predição das médias das cultivares nos níveis 1 e 1 de fila e coluna.</span>
pred &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cult =</span> <span class="kw">levels</span>(StorckEg2<span class="fl">.3.5</span>$cult),
                   <span class="dt">fila =</span> <span class="st">"1"</span>,
                   <span class="dt">colun =</span> <span class="st">"1"</span>)
pred &lt;-<span class="st"> </span><span class="kw">cbind</span>(pred,
              <span class="kw">as.data.frame</span>(<span class="kw">predict</span>(m0,
                                    <span class="dt">newdata =</span> pred,
                                    <span class="dt">interval =</span> <span class="st">"confidence"</span>)))
pred</code></pre></div>
<pre><code>##   cult fila colun  fit      lwr      upr
## 1    A    1     1 10.0  6.84105 13.15895
## 2    B    1     1 12.0  8.84105 15.15895
## 3    C    1     1 15.5 12.34105 18.65895
## 4    D    1     1  9.5  6.34105 12.65895</code></pre>
<p>Se por um lado as diferenças de médias de cultivar são as mesmas qualquer que sejam os níveis dos demais termos, existe uma preferência para usar o efeito médio ao invés de fixar em um nível qualquer. A vantagem que as médias ajustadas tem maior precisão quando consideram a média dos efeitos.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(multcomp, <span class="dt">quietly =</span> <span class="ot">TRUE</span>))

<span class="co"># Vetor de pesos para o valor esperado da cultivar A considerando os</span>
<span class="co"># níveis 1 e 1 de fila e coluna.</span>
l1 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>,    <span class="dv">0</span>,    <span class="dv">0</span>,    <span class="dv">0</span>,    <span class="dv">0</span>,    <span class="dv">0</span>,    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),
             <span class="dt">nrow =</span> <span class="dv">1</span>)
(s1 &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">glht</span>(m0, <span class="dt">linfct =</span> l1)))</code></pre></div>
<pre><code>## 
##   Simultaneous Tests for General Linear Hypotheses
## 
## Fit: lm(formula = rend ~ fila + colun + cult, data = StorckEg2.3.5)
## 
## Linear Hypotheses:
##        Estimate Std. Error t value Pr(&gt;|t|)    
## 1 == 0   10.000      1.291   7.746 0.000243 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## (Adjusted p values reported -- single-step method)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Vetor de pesos para o valor esperado da cultivar A considerando a</span>
<span class="co"># média dos efeitos de fila e coluna (média dos blocos).</span>
l0 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),
             <span class="dt">nrow =</span> <span class="dv">1</span>)
(s0 &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">glht</span>(m0, <span class="dt">linfct =</span> l0)))</code></pre></div>
<pre><code>## 
##   Simultaneous Tests for General Linear Hypotheses
## 
## Fit: lm(formula = rend ~ fila + colun + cult, data = StorckEg2.3.5)
## 
## Linear Hypotheses:
##        Estimate Std. Error t value Pr(&gt;|t|)    
## 1 == 0   7.7500     0.8165   9.492 7.79e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## (Adjusted p values reported -- single-step method)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Os erros padrões também são diferentes, assim como as médias.</span>
<span class="kw">sapply</span>(<span class="kw">list</span>(<span class="st">"l1"</span> =<span class="st"> </span>s1, <span class="st">"l0"</span>  =<span class="st"> </span>s0), function(x) {
    <span class="kw">with</span>(x$test, <span class="kw">c</span>(<span class="st">"Estimate"</span> =<span class="st"> </span>coefficients, <span class="st">"Std.Error"</span> =<span class="st"> </span>sigma))
})</code></pre></div>
<pre><code>##                    l1        l0
## Estimate.1  10.000000 7.7500000
## Std.Error.1  1.290994 0.8164966</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Erros-padrões obtidos matricialmente.</span>
<span class="co"># sqrt(l1 %*% vcov(m0) %*% t(l1))</span>
<span class="co"># sqrt(l0 %*% vcov(m0) %*% t(l0))</span></code></pre></div>
<p>O código acima mostra que ao considerar a médias dos efeitos, o erro-padrão foi menor. Isso porque usando a média, os efeitos se anulam e por isso a contribuição para o erro-padrão da estimativa é 0.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># IC *individual* de cobertura 95%.</span>
<span class="co"># ic &lt;- confint(glht(m0, linfct = L), calpha = univariate_calpha())</span>
<span class="co"># ic &lt;- as.data.frame(ic$confint)</span>

<span class="co"># IC *global* de cobertura 95%. CUIDADO, essa função demora muito quando</span>
<span class="co"># o número de níveis é grande.</span>
ic &lt;-<span class="st"> </span><span class="kw">confint</span>(<span class="kw">glht</span>(m0, <span class="dt">linfct =</span> L))
ic &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(ic$confint)

<span class="kw">names</span>(ic) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"fit"</span>, <span class="st">"lwr"</span>, <span class="st">"upr"</span>)

pred &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">cult =</span> pred$cult, ic)
pred</code></pre></div>
<pre><code>##   cult   fit       lwr      upr
## A    A  7.75  4.982842 10.51716
## B    B  9.75  6.982842 12.51716
## C    C 13.25 10.482842 16.01716
## D    D  7.25  4.482842 10.01716</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(latticeExtra)

<span class="kw">segplot</span>(cult ~<span class="st"> </span>lwr +<span class="st"> </span>upr, <span class="dt">centers =</span> fit, <span class="dt">data =</span> pred,
        <span class="dt">draw =</span> <span class="ot">FALSE</span>, <span class="dt">horizontal =</span> <span class="ot">FALSE</span>,
        <span class="dt">xlab =</span> <span class="st">"Cultivares de alho"</span>,
        <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="st">"Rendimento de alho"</span> ~<span class="st"> </span>(t ~<span class="st"> </span>ha^{-<span class="dv">1</span>})),
        <span class="dt">panel =</span> function(x, y, z, centers, ...) {
            <span class="kw">panel.segplot</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, <span class="dt">z =</span> z, <span class="dt">centers =</span> centers, ...)
            <span class="kw">panel.text</span>(<span class="dt">x =</span> <span class="kw">as.numeric</span>(z), <span class="dt">y =</span> centers,
                       <span class="dt">label =</span> <span class="kw">sprintf</span>(<span class="st">"%0.2f"</span>, centers),
                       <span class="dt">srt =</span> <span class="dv">90</span>, <span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">adj =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, -<span class="fl">0.5</span>))
        })</code></pre></div>
<p><img src="anaExpDQL_files/figure-html/unnamed-chunk-10-1.png" width="600" style="display: block; margin: auto;"></p>
<p>Por fim, uma representação interessante é colocar as médias ajustadas das cultivares com alguma presentação de incerteza, como o intervalo de confiança. No caso, foi usando o intervalo de confiança com cobertura global de 95%. Os intervalos de cobertura individual são aqueles cuja probabilidade de conter o parâmetro é, digamos, 5% para cada coeficiente separadamente. Já o de confiança global, a probabilidade 5% é a de todos os intervalos conterem os parâmetros simultaneamente. Esses intervalos são mais amplos que os de cobertura individual.</p>
</div>
<div id="gerando-experimento-em-dql" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#gerando-experimento-em-dql" class="anchor"> </a></body></html>Gerando experimento em DQL</h2>
<p>A casualização em um experimento em delineamento quadrado latino parece não ser simples devido às restrições de que os tratamentos não podem se repetir na mesma linha nem na mesma coluna. No entanto, gerar esse delineamento é bem simples, conforme ilustra o código a seguir.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qldesign &lt;-<span class="st"> </span>function(dim) {
    <span class="co"># dim: escalar inteiro que é a dimensão do QL.</span>
    M &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>:dim, dim, dim)
    N &lt;-<span class="st"> </span>M +<span class="st"> </span>(<span class="kw">t</span>(M))
    O &lt;-<span class="st"> </span>(N %%<span class="st"> </span>dim) +<span class="st"> </span><span class="dv">1</span>
    lin &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:dim)
    col &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span>:dim)
    M &lt;-<span class="st"> </span>O[lin, col]
    D &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">lin =</span> <span class="kw">gl</span>(dim, <span class="dv">1</span>), <span class="dt">col =</span> <span class="kw">gl</span>(dim, <span class="dv">1</span>))
    D$trat &lt;-<span class="st"> </span><span class="kw">c</span>(M)
    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">M =</span> M, <span class="dt">D =</span> D))
}

<span class="co"># Quadrado latino de dimensão 5.</span>
<span class="kw">set.seed</span>(<span class="dv">2016</span>)
<span class="kw">qldesign</span>(<span class="dt">dim =</span> <span class="dv">5</span>)</code></pre></div>
<pre><code>## $M
##      [,1] [,2] [,3] [,4] [,5]
## [1,]    3    5    1    2    4
## [2,]    2    4    5    1    3
## [3,]    5    2    3    4    1
## [4,]    1    3    4    5    2
## [5,]    4    1    2    3    5
## 
## $D
##    lin col trat
## 1    1   1    3
## 2    2   1    2
## 3    3   1    5
## 4    4   1    1
## 5    5   1    4
## 6    1   2    5
## 7    2   2    4
## 8    3   2    2
## 9    4   2    3
## 10   5   2    1
## 11   1   3    1
## 12   2   3    5
## 13   3   3    3
## 14   4   3    4
## 15   5   3    2
## 16   1   4    2
## 17   2   4    1
## 18   3   4    4
## 19   4   4    5
## 20   5   4    3
## 21   1   5    4
## 22   2   5    3
## 23   3   5    1
## 24   4   5    2
## 25   5   5    5</code></pre>
</div>
<div id="informacoes-da-sessao" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#informacoes-da-sessao" class="anchor"> </a></body></html>Informações da sessão</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.3.2 (2016-10-31)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu precise (12.04.5 LTS)
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets 
## [7] base     
## 
## other attached packages:
##  [1] multcomp_1.4-6       TH.data_1.0-8        MASS_7.3-45         
##  [4] survival_2.39-5      mvtnorm_1.0-6        knitr_1.15.1        
##  [7] vcd_1.4-3            reshape_0.8.6        car_2.1-4           
## [10] qcc_2.6              reshape2_1.4.2       ggplot2_2.2.1       
## [13] latticeExtra_0.6-28  RColorBrewer_1.1-2   lattice_0.20-34     
## [16] labestData_0.1-1.462
## 
## loaded via a namespace (and not attached):
##  [1] zoo_1.7-14         purrr_0.2.2        splines_3.3.2     
##  [4] colorspace_1.3-2   htmltools_0.3.5    yaml_2.1.14       
##  [7] mgcv_1.8-15        pkgdown_0.1.0.9000 nloptr_1.0.4      
## [10] withr_1.0.2        plyr_1.8.4         stringr_1.2.0     
## [13] MatrixModels_0.4-1 munsell_0.4.3      commonmark_1.2    
## [16] gtable_0.2.0       devtools_1.12.0    codetools_0.2-15  
## [19] memoise_1.0.0      evaluate_0.10      labeling_0.3      
## [22] SparseM_1.76       highlight_0.4.7    lmtest_0.9-35     
## [25] quantreg_5.29      pbkrtest_0.4-6     parallel_3.3.2    
## [28] methods_3.3.2      Rcpp_0.12.9        scales_0.4.1      
## [31] backports_1.0.5    desc_1.1.0         pkgload_0.0.0.9000
## [34] lme4_1.1-12        digest_0.6.12      stringi_1.1.2     
## [37] rprojroot_1.2      tools_3.3.2        sandwich_2.3-4    
## [40] magrittr_1.5       lazyeval_0.2.0     tibble_1.2        
## [43] crayon_1.3.2       whisker_0.3-2      Matrix_1.2-7.1    
## [46] xml2_1.1.1         assertthat_0.1     minqa_1.2.4       
## [49] rmarkdown_1.3.9004 roxygen2_6.0.1     R6_2.2.0          
## [52] nnet_7.3-12        nlme_3.1-128</code></pre>
<!------------------------------------------- -->
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#analise-exploratoria">Análise exploratória</a></li>
      <li><a href="#especificacao-e-ajuste-do-modelo">Especificação e ajuste do modelo</a></li>
      <li><a href="#avaliacao-dos-pressupostos">Avaliação dos pressupostos</a></li>
      <li><a href="#inferencias">Inferências</a></li>
      <li><a href="#gerando-experimento-em-dql">Gerando experimento em DQL</a></li>
      <li><a href="#informacoes-da-sessao">Informações da sessão</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by PET Estatística UFPR.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
